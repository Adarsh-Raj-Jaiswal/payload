# üöß **DRAFT:** 3.0 Migration Guide / Breaking Changes

> [!IMPORTANT]
> This document will continue to be updated and cleaned up until the 3.0 release.

## Overview

Payload 3.0 is a major release with breaking changes. This migration guide will cover:

1. What has changed?
2. How to migrate from 2.0 to 3.0 (two options)
  2.a. Moving your existing app to a new 3.0 template
  2.b. Updating your existing app
3. Breaking Changes

// TODO: add links to beta docs once they are live

## What has changed?

The biggest change of 3.0 is the move to Next.js - the Admin Panel and all core Payload functionality is now fully built with Next.js.

Key changes:

- **Next.js**: Payload is now Next.js native, so you can add / run Payload in the same place as any Next.js app
- **Admin Panel**: The Admin Panel has been rebuilt with React Server Components and automatically eliminates server-side code from your admin bundle (SEE YA Webpack)
- **Bundler**: Payload no required an additional bundler, we rely directly on Next.js
- **Payload UI**: All UI components have been abstracted into a separate `@payloadcms/ui` package
- **ESM**: Payload is now fully ESM operated across the board
- **GraphQL**: Will only be initialized when you hit the GraphQL endpoint, and does not affect REST API routes
- **HMR**: Server-side Hot Module Reloading (HMR) works out of the box, with no need for nodemon or similar (when the Payload config changes, your app will re-initialize seamlessly in the background)
- **Sharp**: Has been abstracted to be an optional dependency, you will need to install it seperately if you are using it for image processing
- **API Request / Response**: Payload now relies on the Web Request / Response APIs rather than the Node Request / Response
- **Express**: Is no longer needed or used as middleware (but can still be used with Next.js' Custom Server functionality)
- **Plugins**: All plugins have been standardized to use named exports (as opposed to default exports)
- **Email Adapters**: Email functionality has been abstracted out into email adapters
- **Custom Endpoints**: Root endpoints no longer exist on the config. If you want to create a ‚Äúroot‚Äù endpoint, you can add them to the api folder within your Payload application
- **Uploads**: `staticDir` must now be an absolute path and `staticURL` has been removed
- **Custom Components**: Components containing both server and client code must now be split into separate files

These are not all breaking changes and will not all be applicable to you, however you should still briefly review them to ensure you are aware of the changes and how they may affect your app.

## Migrating from 2.0 to 3.0

To migrate your existing app, you can either:

1. Move your existing Payload configuration to a fresh 3.0 template (which includes all of the Next.js files that you'll need)

**OR**

2. Update your existing app by making the necessary changes to match the new 3.0 structure

### 1 - Move your existing app to a new 3.0 template

1. Create a new Payload 3.0 app using the blank template:

```bash
npx create-payload-app@beta -t blank
```

2. Copy your existing `payload.config` and all dependent files to the new app, review the Payload Config breaking changes outlined [below](#payload-config) and update as necessary.

3. Review the collection changes outlined [here](#collections) and update.

4. If you were using any custom components, endpoints, hooks, or plugins, make sure to update them to the new structure. See all the breaking changes outlined [below](#custom-components).

5. Install any additional dependencies you were using in your 2.0 app

6. Run your app and test that everything is working as expected

If you are facing errors at this stage, review the remaining breaking changes outlined below or reach out to the Payload team for support.

### 2 - Update your existing app to 3.0

1. Update your existing app to the latest version and add additional dependencies:

```bash
// Update Payload to 3.0
pnpm i payload@beta

// Add the new dependencies
pnpm i @payloadcms/next @payloadcms/ui @payloadcms/plugin-cloud
```

2. Add the (payload) folder and required files:
   As Payload 3.0 is now fully Next.js native, you will need to add the required files for the admin UI and route handlers.

   We have consolidated all admin views into a single `page.tsx` and consolidated the API endpoints into single `route.ts` files for simplicity and performance.
   The benefit of this structure is that you only need to compile the admin UI / REST API / GraphQL API a single time then it will be served from the server.
   This means that the admin UI will be faster and more responsive, and the server will be more efficient.

   Your Next.js `/app` folder should include the following:
   - `(payload)`
    - `admin/[[...segments]]`
      - `page.tsx`
      - `not-found.tsx`
    - `api`
      - `[...slug]`
        - `route.ts`
      - `graphql`
        - `route.ts`
    - `graphql-playground`
      - `route.ts`
    - `custom.scss`
    - `layout.tsx`

   We recommend you copy the entire (payload) folder from the blank 3.0 template, or you can create them manually.
   You can find the template on [GitHub](https://github.com/payloadcms/payload/tree/beta/templates/blank-3.0) or use the following command to create a new app and copy from there:

   ```bash
    npx create-payload-app@beta -t blank
    ```

  3. Remove the `server.ts` file:

  The purpose of the `server.ts` file in 2.0 was to boot up an Express app, which was then used to serve the admin panel and API routes. However, since we are no longer relying on Express for this, and instead using Next.js, the entire file can be removed.

  If you were passing any custom code in the `server.ts` file, you should migrate this to the `init` function in your `payload.config.ts` file.

  NOTE: You can still use Express with Next.js by creating a custom server file in the root of your app, i.e. `server.js` and using it as a custom server with Next.js' Custom Server functionality. Learn more about this from the [Next.js documentation](https://nextjs.org/docs/pages/building-your-application/configuring/custom-server).

  4. Update the following files: `next.config.js`,`tsconfig.json`, `package.json` and `payload.config.ts`

  - **next.config.js**:

  To start, copy your existing `next.config.js` file to the new app, then you'll need to update the file to an ESM file.
  You can do this by either:
    - Renaming the file from `next.config.js` to `next.config.mjs`
    **or**
    - Adding the `type: module` property to your `package.json` file

  After you have updated the file to an ESM file, you then need to import and wrap the export in the `withPayload` function. This function is now required for Payload to run and ensures compatibility with other packages that Payload uses such as `drizzle-kit`, `sharp`, `pino`, and `mongodb`.

  ```tsx
  import { withPayload } from '@payloadcms/next/withPayload' // Import the withPayload function from the @payloadcms/next package

    /** @type {import('next').NextConfig} */
    const nextConfig = {
      // Your existing Next.js config here
    }

  export default withPayload(nextConfig) // Wrap in the withPayload function
  ```

  - **tsconfig.json**: Add a TypeScript alias to point to your Payload config, this is required for Payload to work correctly. By default, the `page.tsx` files and `route.ts` files within the `(app)` folder use this alias.

  Next, you should update the `moduleResolution` from `node` to `bundler`. This mode supports package.json "imports" and "exports", but unlike the Node.js resolution modes, `bundler` does not require file extensions on relative import paths. Read more about this in the [TypeScript documentation](https://www.typescriptlang.org/tsconfig/#moduleResolution).


  ```tsx
  {
    "compilerOptions": {
      "baseUrl": ".",
      "paths": {
        "@payloadcms/config": ["./payload.config.ts"] // alias to your Payload config
      }
      "moduleResolution": "bundler", // Use 'bundler' for Next.js
    }
  }
  ```

  - **package.json**: Update existing `scripts` to include the new `dev`, `build` and `start` commands:
    ```json
    {
      "scripts": {
        "dev": "next dev",
        "build": "next build",
        "start": "next start"
      },
    }
    ```

  - **payload.config.ts**: There are a few different changes to the `payload.config.ts` file in 3.0, copy your existing file to the new app and review the breaking changes outlined [below](#payload-config) then update as necessary.

  ```ts
  import { buildConfig } from 'payload/config' // Import from payload/config instead of payload

  export default payload.init(() => {
    // There are several new and depreceated properties in the Payload config:

    return buildConfig({
      // These are a handful of the changes
      admin: {
        // Any bundler related options should be removed
        bundler: 'webpack' // ‚ùå Old

        // These properties have been depreceated
        css: 'custom.scss', // ‚ùå Old
        scss: 'custom.scss', // ‚ùå Old

        // The favicon property has been replaced by icons
        favicon: 'path-to-favicon.svg', // ‚ùå Old
        icons: [{ path: 'path-to-favicon.svg', sizes: '32x32' }] // ‚úÖ New

        // indexHTML has bene deprecated
        indexHTML: 'path-to-index.html' // ‚ùå Old

        // The livePreview.url function has changed
        livePreview: {
          // ‚úÖ New args
          url: ({ collectionConfig, globalConfig }) => {
            return `http://localhost:3000/${collectionConfig.slug}/[id]`
          }
          // ‚ùå Old args
          url: ({ documentInfo }) => {
            return `http://localhost:3000/${documentInfo.slug}/[id]`
          }
        }

        // The meta.ogImage property has been replaced by openGraph.images
        meta: {
          ogImage: '' // ‚ùå Old
          openGraph: {
            images: [] // ‚úÖ New
          }
        }
      }

      // Email functionality has been abstracted out into email adapters
      email: nodemailerAdapter() // ‚úÖ New

      // The logoutRoute and inactivityRoute properties have been combined into a single routes property
      logoutRoute: '/custom-logout', // ‚ùå Old
      inactivityRoute: '/custom-inactivity', // ‚ùå Old
      routes: {
        logout: '/custom-logout', // ‚úÖ New
        inactivity: '/custom-inactivity' // ‚úÖ New
      }

      // Rate limiting has been removed
      rateLimit: 100 // ‚ùå Old

      // Your secret key should be passed directly to the config
      secret: process.env.PAYLOAD_SECRET || 'your-secret-key',

      // Sharp is now an optional dependency
      sharp, // only needed if you are using image resizing or cropping
    })
  })
  ```

  5. Collections: Migrate and update your existing collections, review the collection breaking changes outlined [here](#collections).

  6. If you were using any custom components, endpoints, hooks, or plugins, make sure to update them to the new structure. See all the breaking changes outlined [below](#custom-components).

If errors persist, review the remaining breaking changes outlined below and if you still need assistance, reach out to the Payload team for support.

# Breaking Changes

All breaking changes are divided into the following categories:
- [Environment variables](#environment-variables)
- [Payload Config](#payload-config)
- [Collections](#collections)
- [Fields](#fields)
- [Req](#req-hooks-access-control-etc)
- [Hooks](#hooks)
- [Custom Components](#custom-components)
- [Descriptions and Labels](#descriptions-and-labels)
- [Custom Endpoints](#custom-endpoints)
- [i18n](#i18n)
- [Uploads](#uploads)
- [Plugins](#plugins)

:exclamation: Not all of these changes will be applicable to you, and you may not need to make all of these changes.

We recommend that you get the proper files in place, and then look at your config and dependencies for TypeScript errors, and tackle them by resolving one by one.

## Environment variables

:warning: Environment variables prefixed with `PAYLOAD_PUBLIC` will no longer be available on the client. In order to access them on the client, those will now have to be prefixed with `NEXT_PUBLIC` instead.

## Payload Config

Depreceated properties:
- `admin.bundler`
- `@payloadcms/bundler-webpack` and `@payloadcms/bundler-vite`
- `admin.css` and `admin.scss`
- `admin.indexHTML`
- `rateLimit`
- `admin.favicon` replaced by `admin.icons`
- `admin.logoutRoute` and `admin.inactivityRoute` replaced by `admin.routes`
- `admin.meta.ogImage` replaced by `admin.meta.openGraph.images`

Other changes:
- The secret key should be passed directly to the `payload.config`
- Email now uses email adapters
- `livePreview.url` args have changed
- `views.Edit` / `views.Edit.Default` / `views.Edit.Default.Component` types have changed
- `buildConfig` should be imported directly from `payload` instead of `payload/config`
- `sharp` is now an optional dependency
- You can use new option `admin.custom` for server only files

:rotating_light: The `admin.bundler` property has been depreceated and should be deleted from your Payload config:

  Payload no longer uses an additional bundler, we rely directly on Next.js for bundling.

:rotating_light: The `@payloadcms/bundler-webpack` and `@payloadcms/bundler-vite` packages have been deprecated:

  You can uninstall them from your project by:
    1. Removing them from your `package.json` file
    2. Then re-running `pnpm i / npm i / yarn i`

:rotating_light: The `admin.css` and `admin.scss` properties no longer exist:

  Instead for any global styles you can use `(payload)/custom.scss` to import or add your own styles.

  Plugins that need to inject global styles should do so via the provider config at `admin.components.providers`.

  Here is a basic example of a provider:

  ```tsx
  import React from 'react'
  import './globals.css'

  const MyProvider: React.FC<{children?: any}>= ({ children }) = {
    return (
      <React.fragment>
        {children}
      </React.fragment>
    )
  }

  export default Provider
  ```

  Then in your `payload.config.ts`, you would add this provider to the `admin.components.providers` array:

  ```ts
  admin: {
    components: {
      providers: [
        MyProvider
      ]
    }
  },
  ```


:rotating_light: The `admin.indexHTML` property has been removed.

  You can now add your own custom HTML directly into the `pages/_document.tsx` file.

:rotating_light: Remove any Rate Limiting configuration

  Rate limiting has been removed from Payload. If you were using it, you will need to implement your own rate limiting middleware by using a custom server (Express or similar)

:rotating_light: The `admin.favicon` property has been replaced by `admin.icons` and the types have changed

  ‚ùå Old
  ```ts
  {
    // ...
    admin: {
      favicon: 'path-to-favicon.svg'
    }
  }
  ```

  ‚úÖ New
  ```ts
  {
    // ...
    admin: {
      icons: [{
        path: 'path-to-favicon.svg',
        sizes: '32x32'
      }]
    }
  }
  ```

  This change was made to allow compatibility with Next.js, learn more about how icons are generated [here](https://nextjs.org/docs/app/api-reference/functions/generate-metadata#icons)

:rotating_light: The `admin.logoutRoute` and `admin.inactivityRoute` properties have been combined into a single `admin.routes` property:

  To migrate, simply move those two keys as follows:

  ‚ùå Old
  ```ts
  {
    // ...
    admin: {
      logoutRoute: '/custom-logout',
      inactivityRoute: '/custom-inactivity'
    }
  }
  ```

  ‚úÖ New
  ```ts
  {
    // ...
    admin: {
      routes: {
        logout: '/custom-logout',
        inactivity: '/custom-inactivity'
      }
    }
  }
  ```

:rotating_light: The `admin.meta.ogImage` property has been replaced by `admin.meta.openGraph.images`

  ```ts
  {
    admin: {
      meta: {
        ogImage: ''
      }
    }
  }
  ```

  ‚úÖ New
  ```ts
  {
    admin: {
      meta: {
        openGraph: {
          images: []
        }
      }
    }
  }
  ```

Next.js reference: https://nextjs.org/docs/app/api-reference/functions/generate-metadata#opengraph

:rotating_light: Your secret key should now be passed directly to the `payload.config.ts` file.

  This used to be passed to the `payload.init()` function of your `server.ts` file. It now should be set in your `payload.config.ts` instead:

  ```ts
  buildConfig({
    // Rest of your config
    secret: process.env.PAYLOAD_SECRET
  })
  ```

:rotating_light: Email functionality has been abstracted out into email adapters.

- All existing nodemailer functionality was abstracted into the `@payloadcms/email-nodemailer` package
- No longer configured with ethereal.email by default.
- Ability to pass email into the `init` function has been removed.
- Warning will be given on startup if email not configured. Any `sendEmail` call will simply log the `To address` and `subject`.
- A Resend adapter is now also available via the `@payloadcms/email-resend` package.

  ‚ùå Old
  ```ts
  export default buildConfig({
    email: {
      transport: someNodemailerTransport
      fromName: 'hello',
      fromAddress: 'hello@example.com',
    },
  })
  ```

  ‚úÖ New
  ```ts
  import { nodemailerAdapter } from '@payloadcms/email-nodemailer' // Import the nodemailer adapter

  export default buildConfig({
    email: nodemailerAdapter() // Pass the email adapter
  })

  export default buildConfig({
    email: nodemailerAdapter({
    // pass in transport options if needed
      defaultFromAddress: 'info@payloadcms.com',
      defaultFromName: 'Payload',
      transport: await nodemailer.createTransport({
        host: process.env.SMTP_HOST,
        port: 587,
        auth: {
          user: process.env.SMTP_USER,
          pass: process.env.SMTP_PASS,
        },
      })
    })
  })
  ```

:warning: The args of the `livePreview.url` function have changed.

  It no longer receives `documentInfo` as an arg, and instead it has `collectionConfig` and `globalConfig`.

:warning: The `views.Edit` / `views.Edit.Default` / `views.Edit.Default.Component` properties are no longer of type `AdminViewComponent` like the other views.

  Instead, their new type is `React.FC<EditViewProps>` where you now only receive the config slug. This is because of how custom edit views need to be rendered server-side, then returned by a client-component (i.e. the document drawer).

:warning: The  `href` and `isActive` functions in the view tab config no longer sends the `match` or `location` arguments.

  This is is a property specific to React Router, not Next.js. If you need to do fancy matching similar to this, use a custom tab that fires of some hooks, i.e. `usePathname()` and run it through your own utility functions.

:warning: `buildConfig` should be imported directly from `payload` instead of `payload/config`

:warning: `sharp` is now an optional dependency

  Sharp is no longer required and should only be defined if you have configured image resizing or cropping

:warning: Use the `custom` property for ***server only*** files.

  The `admin.custom` property is still functional will be available in both server and client bundles.

  ```ts
  buildConfig({
    custom: {
      someProperty: 'value' // Available in server only
    },
    admin: {
      custom: {
        name: 'Customer portal' // Available in server and client
      }
    },
  })
  ```

## Collections

Depreceated properties:
- `collection.admin.hooks`
- `collection.admin.components.views[].Tab.pillLabel` replaced with `collection.admin.components.views[].Tab.Pill`

:rotating_light: The `collection.admin.hooks` property has been removed.

  Instead, you should use the new `beforeDuplicate` field-level hook which takes the usual field hook arguments.

  ‚ùå Old
  ```tsx
  {
    admin: {
      hooks: {
        beforeDuplicate: async ({ data }) => {
          return {
            ...data,
            title: `${data.title} - Copy`
          }
        }
      }
    }
  }
  ```

  ‚úÖ New
  ```tsx
  {
    admin: {...},
    fields: [
      {
        name: 'title',
        type: 'text',
        admin: {
          hooks: {
            beforeDuplicate: async ({ data }) => {
              return {
                ...data,
                title: `${data.title} - Copy`
              }
            }
          }
        }
      }
    ]
  }
  ```


:rotating_light: The `admin.components.views[].Tab.pillLabel` has been replaced with `admin.components.views[].Tab.Pill`

  ‚ùå Old
  ```tsx
  {
    admin: {
      components: {
        views: {
          Edit: {
            Tab: {
              pillLabel: '',
            },
          },
        },
      },
    },
  }
  ```

  ‚úÖ New
  ```tsx
  {
    admin: {
      components: {
        views: {
          Edit: {
            Tab: {
              Pill: MyPill,
            },
          },
        },
      },
    },
  }
  ```

## Fields

Breaking changes:
- `admin.description` args no longer include `data`
- `admin.label` args no longer include `data`
- `admin.components.Cell` no longer receives `rowData` or `cellData`
- `admin.components.RowLabel` no longer accepts a function
- `Fields` type was renamed to `FormState`

:warning: The `admin.description` and  `admin.label`* field properties no longer attach `data` to its args:

*`admin.label` is only applicable to the `collapsible` field

  This is because we cannot pass your `description` or `label` function to the client for execution (functions are not serializable, and state is held on the client). To display dynamic descriptions that use the current `data` or `path`, you must now pass a custom component and subscribe to the field state:

  ```tsx
  import React from 'react'
  import { useFieldProps, useFormFields } from '@payloadcms/ui/forms'
  import type { DescriptionComponent } from 'payload/types'

  export const CustomFieldDescriptionComponent: DescriptionComponent = () => {
    const { path } = useFieldProps()
    const { value } = useFormFields(([fields]) = fields[path])

    return (
      <div>
        {`Component description: ${path} - ${value}`}

      </div>
    )
  }

  export const CustomFieldLabelComponent: LabelComponent = () => {
    const { path } = useFieldProps()
    const { value } = useFormFields(([fields]) =fields[path])

    return (
      <div>
        {`Component label: ${path} - ${value}`}
      </div>
    )
  }
  ```

:warning: The `admin.components.Cell` option no longer receives `rowData`  or `cellData`.

  If using a custom component, you must now get the data yourself via the `useTableCell` hook, i.e. `const { cellData, rowData } = useTableCell()`.

  ```tsx
  import React from 'react'
  import { useTableCell } from '@payloadcms/ui/elements/Table'

  export const CustomCellComponent: CellComponent = () => {
    const { cellData, rowData } = useTableCell()

    return (
      <div>
        {`Component cell: ${cellData}`}
      </div>
    )
  }
  ```

:warning: `admin.components.RowLabel` no longer accepts a function, instead use a custom component and make use of the `useRowLabel` hook:

  ‚ùå Old:
  ```tsx
  {
    type: 'array',
    admin: {
      components: {
        RowLabel: ({ data }) => {
          console.log(data)
          return data?.title || 'Untitled'
        },
      }
    }
  }
  ```

  ‚úÖ New:
  ```tsx
  {
    type: 'array',
    admin: {
      components: {
        RowLabel: ArrayRowLabel
      }
    }
  }
  ```

  Example custom Row Label component:

  ```tsx
  'use client'

  import React from 'react'

  import type { RowLabelComponent } from 'payload/types'
  import { useRowLabel } from '@payloadcms/ui/forms/RowLabel/Context'

  export const ArrayRowLabel: RowLabelComponent = () ={
    const { data } = useRowLabel<{ title: string }>()
    return (
      <div>{data.title || 'Untitled'}</div>
    )
  }
  ```

:warning: The `Fields` type was renamed to `FormState`:

  This was changed for improved semantics. If you were previously importing this type in your own application, simply change the import name:

  ‚ùå Old
  ```tsx
  import type { Fields } from 'payload/types'
  ```

  ‚úÖ New
  ```tsx
  import type { FormState } from 'payload/types'
  ```

## Req

  :warning: The `req` previously extended an [Express Request](https://expressjs.com/en/api.html#req), it now extends the [Web Request](https://developer.mozilla.org/en-US/docs/Web/API/Request). As a result, there may be minor differences in the properties and methods available on the `req` object, for example, `req.headers['content-type']` would change to `req.headers.get('content-type')`.

## Hooks

These changes affect the following properties:
- `useTitle`
- `useDocumentInfo`
- `useConfig`
- `DocumentTabProps`
- `beforeDuplicate`
- `useCollapsible`

:warning: The `useTitle` hook has been absorbed by the `useDocumentInfo` hook.

  Now, you can get title directly from document info context, i.e. `const { title } = useDocumentInfo()`.

:warning: The `useDocumentInfo` hook no longer returns a `SanizitedCollectionConfig` or `SanitizedGlobalConfig`:

  This is because the configs themselves are not serializable and so they cannot be thread through to the client, i.e. the `DocumentInfoContext`. Instead, various properties of the config are passed instead, like `collectionSlug` and `globalSlug`.  You can use these to access a client-side config, if needed, through the `useConfig` hook (see next bullet).

:warning: The `useConfig` hook now returns a `ClientConfig` and not a `SanizitedConfig`.

  This is because the config itself is not serializable and so it is not able to be thread through to the client, i.e. the `ConfigContext`.

:warning: `DocumentTabProps` no longer contains `id` or `isEditing`.

  Instead you can use the `useDocumentInfo` hook to get this information (see the second bullet in the list).

:warning: `beforeDuplicate` field hooks have been added to `unique` fields to automatically add ‚Äú- Copy‚Äù to the end.

:warning: The `useCollapsible` hook has had slight changes to its property names:

:warning: `collapsed` has been replaced with `isCollapsed` and `withinCollapsible` has been replaced with `isWithinCollapsible`.

## Custom Components

- All Payload components have been moved to the `@payloadcms/ui` package
- Custom components must be split into server and client components

:warning: Import all Payload React components via the `@payloadcms/ui` package instead of `payload`:

  If you were previously importing components into your app from the `payload` package, for example to create a custom component, you will need to:

  - Change your import paths
  - Migrate your component (if necessary)

  ```tsx
  import { Button } from '@payloadcms/ui/elements/Button'

  // TODO: Add new full list of exports
  ```

:warning: Migrate all Custom Components to Server Components.

  All Custom Components are now server-rendered, and therefore, cannot use state or hooks directly.

  If you're using a Custom Component in your app that requires state or hooks, define your component in a separate file with the `'use client'` directive at the top, then render *that* client component within your server component.

  :exclamation: Remember you can only pass serializable props to this component, so props cannot be blindly spread.

  ```tsx
  import React from 'react'
  import type { ServerOnlyProps } from './types.ts'
  import MyClientComponent from './client.tsx'

  export const MyServerComponent: React.FC<ServerOnlyProps> = (serverOnlyProps) => {
      const clientOnlyProps = {
        // ... sanitize server-only props here as needed
      }

      return (
        <MyClientComponent {...clientOnlyProps} />
      )
  }
  ```

TODO: What is this??
3. Components that return a function have webpack errors.

Will need to document the following (if intended as a breaking change)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0fcec415-321b-48ca-a915-504d61c448b3/94156826-74ee-4708-aa73-1beb11ad0306/Untitled.png)

## Descriptions and Labels

  Several `description` and `label` properties are now nested within the `components` property of the config.

  - Globals config: `admin.description` no longer accepts a custom component. You will have to move it to `admin.components.elements.Description`

  - Collections config: `admin.description` no longer accepts a custom component. You will have to move it to `admin.components.edit.Description`

  - All Fields: `field.admin.description` no longer accepts a custom component. You will have to move it to `field.admin.components.Description`

  - Collapsible Field: `field.label` no longer accepts a custom component. You will have to move it to `field.admin.components.RowLabel`

  - Array Field: `field.admin.components.RowLabel` no longer accepts strings or records

  - If you are using our exported field components in your own app, their `labelProps` property has been stripped down and no longer contains the `label` and `required` prop. Those can now only be configured at the top-level.

## Custom Endpoints

Overview of changes:
- `root` endpoints no longer exist on the config
- Endpoint handlers no longer resolve `data` for you on the request
- Handlers no longer resolve `locale` and `fallbackLocale` for you

  :warning: `root` endpoints no longer exist on the config. If you want to create a ‚Äúroot‚Äù endpoint, you can add them to the (api) folder within your Payload application.

  Learn more about how to create custom endpoints in the [Next.js docs](https://nextjs.org/docs/app/api-reference/file-conventions/route).

  :warning: Endpoint handlers changes
    - arguments
      - ‚ùå Before: `(req, res, next)`
      - ‚úÖ After: `(req)`

    - return
      - ‚ùå Before: `res.json`, `res.send`, etc.
      - ‚úÖ After: a valid HTTP [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response)

  ‚ùå Old
  ```tsx
  {
    path: '/whoami/:parameter',
    method: 'post',
    handler: (req, res) => {
      res.json({
        parameter: req.params.parameter,
        name: req.body.name,
        age: req.body.age,
      })
    }
  }
  ```

  ‚úÖ New
  ```tsx
  {
    path: '/whoami/:parameter',
    method: 'post',
    handler: (req) => {
      return Response.json({
        parameter: req.routeParams.parameter,
        // ^^ `params` is now `routeParams`
        name: req.data.name,
        age: req.data.age,
      })
    }
  }
  ```

  :warning: Handlers no longer resolve `data` for you on the request, use `req.json()` or you can use the `addDataAndFileToRequest` function from Payload utilities:

  ‚ùå Before
  ```tsx
  {
    path: '/whoami/:parameter',
    method: 'post',
    handler: async (req) => {
      return Response.json({
        name: req.data.name, // data will be undefined
      })
    }
  }
  ```

  ‚úÖ After
  ```tsx
  import { addDataAndFileToRequest } from '@payloadcms/next/utilities'

  {
    path: '/whoami/:parameter',
    method: 'post',
    handler: async (req) => {
      // mutates req, must be awaited
      await addDataAndFileToRequest(req)

      return Response.json({
        name: req.data.name, // data is now available
      })
    }
  }
  ```

  :warning: Handlers no longer resolve `locale` and `fallbackLocale` for you, use the `addLocalesToRequest` function from Payload utilities:

  ‚ùå Old
  ```tsx
  {
    path: '/whoami/:parameter',
    method: 'post',
    handler: async (req) => {
      return Response.json({
        // will be undefined
        fallbackLocale: req.fallbackLocale,
        locale: req.locale,
      })
    }
  }
  ```

  ‚úÖ New
  ```tsx
  import { addLocalesToRequest } from '@payloadcms/next/utilities'
  {
    path: '/whoami/:parameter',
    method: 'post',
    handler: async (req) => {
      // mutates req
      addLocalesToRequest(req)

      return Response.json({
        fallbackLocale: req.fallbackLocale,
        locale: req.locale,
      })
    }
  }
  ```

## i18n

  :warning: `useTranslation()` hook no longer takes any options, any translations using shorthand accessors will need to use the entire `group:key`:

  ‚ùå Old
  ```tsx
  const { i18n, t } = useTranslation('general')
  return <p>{t('cancel')}</p>
  ```

  ‚úÖ New
  ```tsx
  const { i18n, t } = useTranslation()
  return <p>{t('general:cancel')}</p>
  ```

  :warning: `react-i18n` was removed, the `Trans` component from react-i18n has been replaced with a Payload provided solution. You can instead `import { Translation } from "@payloadcms/ui"`

  Example translation string:
  ```tsx
  "loggedInChangePassword": "To change your password, go to your <0>account</0> and edit your password there."
  ```

  ‚ùå Old
  ```tsx
  <Trans i18nKey="loggedInChangePassword" t={t}>
    <Link to={`${admin}/account`}>account</Link>
  </Trans>
  ```

  ‚úÖ New
  ```tsx
  <Translation
    t={t}
    i18nKey="authentication:loggedInChangePassword"
    elements={{
      '0': ({ children }) => <Link href={`${admin}/account`} children={children} />,
    }}
  />
  ```

## Uploads

  :warning: `staticDir` must now be an absolute path. Previously it would use the location of the Payload config and merge the relative path for `staticDir` when possible.

  :warning: `staticURL` has been removed. If you were using this format URLs when using an external provider, you can leverage the `generateFileURL` functions in order to do the same.

## Plugins

*All* plugins have been standardized to use *named exports* (as opposed to default exports). Most also have a suffix of `Plugin` to make it clear what is being imported.


‚ùå Old
```tsx
import seo from '@payloadcms/plugin-seo'
import stripePlugin from '@payloadcms/plugin-stripe'
```
‚úÖ New
```tsx
import { seoPlugin } from '@payloadcms/plugin-seo'
import { stripePlugin } from '@payloadcms/plugin-stripe'
```

### `@payloadcms/plugin-cloud-storage`

:rotating_light: The adapters that are exported from `@payloadcms/plugin-cloud-storage` (ie. `@payloadcms/plugin-cloud-storage/s3`) package have been removed.

New *standalone* packages have been created for each of the existing adapters. Refer to the documentation for the one that you use.

| Service              | Package                                                                      |
| -------------------- | ---------------------------------------------------------------------------- |
| Vercel Blob          | https://github.com/payloadcms/payload/tree/beta/packages/storage-vercel-blob |
| AWS S3               | https://github.com/payloadcms/payload/tree/beta/packages/storage-s3          |
| Azure                | https://github.com/payloadcms/payload/tree/beta/packages/storage-azure       |
| Google Cloud Storage | https://github.com/payloadcms/payload/tree/beta/packages/storage-gcs         |

:warning: `@payloadcms/plugin-cloud-storage` is still fully supported but should only to be used if you are providing a custom adapter that does not have a dedicated package.

:warning: If you have created a custom adapter, the type must now provide a `name` property.

‚ùå Old
```tsx
import { cloudStorage } from '@payloadcms/plugin-cloud-storage'
import { s3Adapter } from '@payloadcms/plugin-cloud-storage/s3'

plugins: [
    cloudStorage({
      collections: {
        [mediaSlug]: {
          adapter: s3Adapter({
            bucket: process.env.S3_BUCKET,
            config: {
              credentials: {
                accessKeyId: process.env.S3_ACCESS_KEY_ID,
                secretAccessKey: process.env.S3_SECRET_ACCESS_KEY,
              },
              region: process.env.S3_REGION,
            },
          }),
        },
      },
    }),
  ],
```

‚úÖ New
```tsx
 import { s3Storage } from '@payloadcms/storage-s3'

 plugins: [
    s3Storage({
      collections: {
        [mediaSlug]: true,
      },
      bucket: process.env.S3_BUCKET,
      config: {
        credentials: {
          accessKeyId: process.env.S3_ACCESS_KEY_ID,
          secretAccessKey: process.env.S3_SECRET_ACCESS_KEY,
        },
        region: process.env.S3_REGION,
      },
    }),
  ],
```

### `@payloadcms/plugin-form-builder`

:warning: Field overrides for form and form submission collections now accept a function with a `defaultFields` inside the args instead of an array of config:

‚ùå Old
```tsx
fields: [
  {
    name: 'custom',
    type: 'text',
  }
]
```

‚úÖ New
```tsx
fields: ({ defaultFields }) => {
  return [
    ...defaultFields,
    {
      name: 'custom',
      type: 'text',
    },
  ]
}
```

### `@payloadcms/plugin-redirects`

:warning: Field overrides for the redirects collection now accepts a function with a `defaultFields` inside the args instead of an array of config

‚ùå Old
```tsx
fields: [
  {
    name: 'custom',
    type: 'text',
  }
]
```

‚úÖ New
```tsx
fields: ({ defaultFields }) => {
  return [
    ...defaultFields,
    {
      name: 'custom',
      type: 'text',
    },
  ]
}
```

### `@payloadcms/richtext-lexical`

// TODO: Needs comprehensive breaking changes / migration steps
